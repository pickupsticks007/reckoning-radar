<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Reckoning Radar — Epstein Files Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://use.typekit.net/zzw7dfl.css">
<style>

[data-theme="light"] {
  --bg:             #F7F4EF;
  --bg-secondary:   #EDE9E1;
  --surface:        #FFFFFF;
  --surface-raised: #FAFAF8;
  --border:         rgba(0,0,0,0.08);
  --border-strong:  rgba(0,0,0,0.14);
  --accent:         #1A1A1A;
  --accent-dim:     rgba(26,26,26,0.06);
  --accent-border:  rgba(26,26,26,0.15);
  --accent-glow:    rgba(26,26,26,0.08);
  --accent-btn:     #1A1A1A;
  --accent-btn-text: #FFFFFF;
  --text-primary:   #0D0D0D;
  --text-secondary: #4A4A4A;
  --text-tertiary:  #888888;
  --text-inverse:   #FFFFFF;
  --confirmed:      #1A6B3C;
  --confirmed-bg:   rgba(26,107,60,0.08);
  --confirmed-border: rgba(26,107,60,0.25);
  --corroborated:   #1A5C8A;
  --corroborated-bg: rgba(26,92,138,0.08);
  --corroborated-border: rgba(26,92,138,0.25);
  --indicated:      #8A5A1A;
  --indicated-bg:   rgba(138,90,26,0.08);
  --indicated-border: rgba(138,90,26,0.25);
  --unverified:     #8A1A1A;
  --unverified-bg:  rgba(138,26,26,0.08);
  --unverified-border: rgba(138,26,26,0.25);
  --shadow-sm:      0 1px 3px rgba(0,0,0,0.06);
  --shadow-md:      0 4px 12px rgba(0,0,0,0.08);
  --topbar-bg:      rgba(247,244,239,0.95);
}

[data-theme="dark"] {
  --bg:             #1a1a1a;
  --bg-secondary:   #141414;
  --surface:        rgba(255,255,255,0.03);
  --surface-raised: rgba(255,255,255,0.05);
  --border:         rgba(255,255,255,0.08);
  --border-strong:  rgba(255,255,255,0.14);
  --accent:         #FFED29;
  --accent-dim:     rgba(255,237,41,0.08);
  --accent-border:  rgba(255,237,41,0.2);
  --accent-glow:    rgba(255,237,41,0.15);
  --accent-btn:     #FFED29;
  --accent-btn-text: #2A2A2A;
  --text-primary:   #FFFFFF;
  --text-secondary: #b0b0b0;
  --text-tertiary:  #606060;
  --text-inverse:   #1A1A1A;
  --confirmed:      #4ade80;
  --confirmed-bg:   rgba(74,222,128,0.08);
  --confirmed-border: rgba(74,222,128,0.25);
  --corroborated:   #60a5fa;
  --corroborated-bg: rgba(96,165,250,0.08);
  --corroborated-border: rgba(96,165,250,0.25);
  --indicated:      #FFED29;
  --indicated-bg:   rgba(255,237,41,0.08);
  --indicated-border: rgba(255,237,41,0.25);
  --unverified:     #f87171;
  --unverified-bg:  rgba(248,113,113,0.08);
  --unverified-border: rgba(248,113,113,0.25);
  --shadow-sm:      0 1px 3px rgba(0,0,0,0.3);
  --shadow-md:      0 4px 12px rgba(0,0,0,0.4);
  --topbar-bg:      rgba(26,26,26,0.95);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'neue-haas-grotesk-display', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text-primary);
  font-size: 14px;
  line-height: 1.5;
  min-height: 100vh;
}

.app { display: grid; grid-template-columns: 200px 1fr 260px; grid-template-rows: 56px 1fr; height: 100vh; overflow: hidden; }
.topbar { grid-column: 1/-1; grid-row: 1; display: flex; align-items: center; gap: 1rem; padding: 0 1.25rem; background: var(--topbar-bg); border-bottom: 1px solid var(--border); backdrop-filter: blur(12px); position: sticky; top: 0; z-index: 100; }
.sidebar-left { grid-column: 1; grid-row: 2; overflow-y: auto; border-right: 1px solid var(--border); padding: 1rem 0.75rem; background: var(--bg-secondary); }
.main { grid-column: 2; grid-row: 2; overflow-y: auto; padding: 1.5rem 1.75rem; }
.sidebar-right { grid-column: 3; grid-row: 2; overflow-y: auto; border-left: 1px solid var(--border); padding: 1rem; background: var(--bg-secondary); }

.topbar-logo { flex-shrink: 0; display: flex; align-items: center; }
.topbar-logo svg { height: 28px; width: auto; }
.topbar-center { flex: 1; max-width: 520px; display: flex; align-items: center; gap: 0.5rem; background: var(--surface); border: 1px solid var(--border-strong); border-radius: 8px; padding: 0 0.75rem; }
.search-icon { color: var(--text-tertiary); font-size: 1rem; }
.search-bar { flex: 1; border: none; background: transparent; color: var(--text-primary); font-family: 'DM Mono', monospace; font-size: 0.8rem; outline: none; padding: 0.5rem 0; }
.search-bar::placeholder { color: var(--text-tertiary); }
.topbar-right { margin-left: auto; display: flex; align-items: center; gap: 0.75rem; }
.status-dot { width: 7px; height: 7px; border-radius: 50%; background: #1A6B3C; box-shadow: 0 0 6px rgba(26,107,60,0.6); }
.status-text { font-family: 'DM Mono', monospace; font-size: 0.7rem; color: var(--text-secondary); letter-spacing: 0.05em; }
.theme-toggle { display: flex; align-items: center; gap: 0.4rem; background: none; border: 1px solid var(--border); border-radius: 20px; padding: 0.25rem 0.6rem; cursor: pointer; color: var(--text-secondary); font-family: 'DM Mono', monospace; font-size: 0.65rem; letter-spacing: 0.08em; }
.toggle-track { width: 28px; height: 16px; background: var(--border-strong); border-radius: 8px; position: relative; }
.toggle-thumb { width: 12px; height: 12px; background: var(--accent); border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: transform 0.2s; }
[data-theme="dark"] .toggle-thumb { transform: translateX(12px); }
.btn-primary { background: var(--accent-btn); color: var(--accent-btn-text); border: none; border-radius: 7px; padding: 0.5rem 1.1rem; font-family: 'DM Mono', monospace; font-size: 0.72rem; font-weight: 500; letter-spacing: 0.05em; cursor: pointer; white-space: nowrap; }
.btn-primary:hover { opacity: 0.85; }

.sidebar-section { margin-bottom: 1.5rem; }
.sidebar-label { font-family: 'DM Mono', monospace; font-size: 0.62rem; color: var(--text-tertiary); letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 0.5rem; padding: 0 0.25rem; }
.nav-item { display: flex; justify-content: space-between; align-items: center; padding: 0.4rem 0.5rem; border-radius: 6px; cursor: pointer; color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 0.15rem; }
.nav-item:hover { background: var(--accent-dim); color: var(--text-primary); }
.nav-item.active { background: var(--accent-dim); color: var(--text-primary); font-weight: 500; border-left: 2px solid var(--accent); }
.nav-count { font-family: 'DM Mono', monospace; font-size: 0.68rem; color: var(--text-tertiary); background: var(--border); padding: 0.1rem 0.4rem; border-radius: 4px; }
.nav-item.coming-soon { opacity: 0.4; cursor: default; }
.coming-soon-badge { font-family: 'DM Mono', monospace; font-size: 0.55rem; color: var(--text-tertiary); letter-spacing: 0.06em; border: 1px solid var(--border); border-radius: 3px; padding: 0.05rem 0.3rem; }

.subject-name { font-size: 2.2rem; font-weight: 700; letter-spacing: -0.02em; line-height: 1.1; margin-bottom: 0.6rem; }
.subject-meta { display: flex; gap: 0.4rem; flex-wrap: wrap; align-items: center; }
.meta-pill { font-family: 'DM Mono', monospace; font-size: 0.68rem; padding: 0.3rem 0.7rem; border-radius: 20px; background: var(--surface); border: 1px solid var(--border); color: var(--text-secondary); letter-spacing: 0.04em; text-transform: uppercase; }
.meta-pill.accent { background: var(--accent); color: var(--accent-btn-text); border-color: var(--accent); }

.stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin: 1.25rem 0; }
.stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1rem; }
.stat-value { font-size: 1.5rem; font-weight: 700; letter-spacing: -0.02em; }
.stat-label { font-family: 'DM Mono', monospace; font-size: 0.62rem; color: var(--text-tertiary); letter-spacing: 0.08em; text-transform: uppercase; margin-top: 0.25rem; }

.section-title { font-family: 'DM Mono', monospace; font-size: 0.68rem; color: var(--text-tertiary); letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border); }

.profile-summary { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1.1rem 1.25rem; margin-bottom: 1.5rem; font-size: 0.875rem; color: var(--text-secondary); line-height: 1.65; }

.email-volume { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1rem 1.25rem; margin-bottom: 1.5rem; }
.email-volume-label { font-family: 'DM Mono', monospace; font-size: 0.62rem; color: var(--text-tertiary); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 0.6rem; display: flex; justify-content: space-between; }
.email-volume-bar { height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.email-volume-fill { height: 100%; background: var(--accent); border-radius: 3px; transition: width 0.6s ease; }
.email-volume-count { font-size: 1.4rem; font-weight: 700; letter-spacing: -0.02em; margin-top: 0.5rem; }
.email-volume-sub { font-family: 'DM Mono', monospace; font-size: 0.62rem; color: var(--text-tertiary); }

.conf-badge { font-family: 'DM Mono', monospace; font-size: 0.65rem; padding: 0.25rem 0.65rem; border-radius: 20px; letter-spacing: 0.06em; white-space: nowrap; }
.conf-badge.confirmed { background: var(--confirmed-bg); color: var(--confirmed); border: 1px solid var(--confirmed-border); }
.conf-badge.corroborated { background: var(--corroborated-bg); color: var(--corroborated); border: 1px solid var(--corroborated-border); }
.conf-badge.indicated { background: var(--indicated-bg); color: var(--indicated); border: 1px solid var(--indicated-border); }
.conf-badge.unverified { background: var(--unverified-bg); color: var(--unverified); border: 1px solid var(--unverified-border); }

.results-grid { display: flex; flex-direction: column; gap: 0.6rem; }
.result-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1rem 1.25rem; cursor: pointer; transition: border-color 0.15s, box-shadow 0.15s; display: flex; justify-content: space-between; align-items: center; gap: 1rem; }
.result-card:hover { border-color: var(--border-strong); box-shadow: var(--shadow-sm); }
.result-name { font-size: 1rem; font-weight: 600; margin-bottom: 0.2rem; }
.result-meta { font-family: 'DM Mono', monospace; font-size: 0.68rem; color: var(--text-tertiary); }
.result-docs { font-family: 'DM Mono', monospace; font-size: 0.7rem; color: var(--text-secondary); text-align: right; white-space: nowrap; }

.panel-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1rem; margin-bottom: 0.75rem; }
.panel-card-title { font-family: 'DM Mono', monospace; font-size: 0.6rem; color: var(--text-tertiary); letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 0.75rem; }
.power-row { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
.power-label { font-size: 0.72rem; color: var(--text-secondary); width: 95px; flex-shrink: 0; }
.power-track { flex: 1; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
.power-fill { height: 100%; background: var(--accent); border-radius: 2px; transition: width 0.6s ease; }
.power-val { font-family: 'DM Mono', monospace; font-size: 0.68rem; color: var(--text-secondary); width: 24px; text-align: right; }

.landing { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; text-align: center; gap: 1rem; }
.landing-title { font-size: 1.1rem; font-weight: 600; color: var(--text-secondary); }
.landing-sub { font-family: 'DM Mono', monospace; font-size: 0.7rem; color: var(--text-tertiary); letter-spacing: 0.08em; max-width: 360px; line-height: 1.7; }
.landing-suggestions { display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; margin-top: 0.5rem; }
.suggestion-chip { font-family: 'DM Mono', monospace; font-size: 0.68rem; padding: 0.35rem 0.75rem; border: 1px solid var(--border); border-radius: 20px; color: var(--text-secondary); cursor: pointer; background: var(--surface); }
.suggestion-chip:hover { border-color: var(--accent); color: var(--text-primary); }

.state-msg { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 300px; gap: 0.75rem; }
.state-label { font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--text-tertiary); letter-spacing: 0.12em; }
.state-sub { font-size: 0.85rem; color: var(--text-secondary); max-width: 340px; text-align: center; }

</style>
</head>
<body>
<div class="app">

  <header class="topbar">
    <div class="topbar-logo">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 55" fill="currentColor">
        <text font-family="neue-haas-grotesk-display, sans-serif" font-weight="700" font-size="28" x="0" y="36">Reckoning Radar</text>
        <text font-family="neue-haas-grotesk-display, sans-serif" font-weight="300" font-size="10" letter-spacing="3" x="1" y="50">THE</text>
      </svg>
    </div>

    <div class="topbar-center">
      <span class="search-icon">⌕</span>
      <input class="search-bar" id="searchInput" type="text" placeholder="Search — Ghislaine Maxwell, Bill Gates, Lesley Groff…">
    </div>

    <div class="topbar-right">
      <button class="theme-toggle" onclick="toggleTheme()">
        <span id="toggleLabel">LIGHT</span>
        <div class="toggle-track"><div class="toggle-thumb"></div></div>
      </button>
      <div style="display:flex;align-items:center;gap:0.4rem;">
        <div class="status-dot"></div>
        <span class="status-text">68 profiles indexed</span>
      </div>
    </div>
  </header>

  <aside class="sidebar-left">
    <div class="sidebar-section">
      <div class="sidebar-label">Query Type</div>
      <div class="nav-item active"><span>Person Profile</span></div>
      <div class="nav-item coming-soon"><span>Flight Manifests</span><span class="coming-soon-badge">SOON</span></div>
      <div class="nav-item coming-soon"><span>Network Graph</span><span class="coming-soon-badge">SOON</span></div>
      <div class="nav-item coming-soon"><span>Location Map</span><span class="coming-soon-badge">SOON</span></div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-label">Category</div>
      <div class="nav-item filter-item" data-filter="category" data-value="finance"><span>Finance</span></div>
      <div class="nav-item filter-item" data-filter="category" data-value="politics"><span>Politics</span></div>
      <div class="nav-item filter-item" data-filter="category" data-value="technology"><span>Technology</span></div>
      <div class="nav-item filter-item" data-filter="category" data-value="legal"><span>Legal</span></div>
      <div class="nav-item filter-item" data-filter="category" data-value="academia"><span>Academia</span></div>
      <div class="nav-item filter-item" data-filter="category" data-value="entertainment"><span>Entertainment</span></div>
      <div class="nav-item filter-item" data-filter="category" data-value="royalty"><span>Royalty</span></div>
      <div class="nav-item filter-item" data-filter="category" data-value="media"><span>Media</span></div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-label">Relationship</div>
      <div class="nav-item filter-item" data-filter="relationship" data-value="direct_contact"><span>Direct Contact</span></div>
      <div class="nav-item filter-item" data-filter="relationship" data-value="employee"><span>Employee / Staff</span></div>
      <div class="nav-item filter-item" data-filter="relationship" data-value="alleged_client"><span>Alleged Client</span></div>
      <div class="nav-item filter-item" data-filter="relationship" data-value="victim"><span>Victim / Survivor</span></div>
      <div class="nav-item filter-item" data-filter="relationship" data-value="legal_counsel"><span>Legal Counsel</span></div>
    </div>
  </aside>

  <main class="main" id="main">
    <div class="landing">
      <div class="landing-title">Search the Epstein Intelligence Database</div>
      <div class="landing-sub">68 individuals indexed from the Epstein email archive. Search by name to view profiles, email volume, and power index.</div>
      <div class="landing-suggestions">
        <span class="suggestion-chip" onclick="doSearch('Ghislaine Maxwell')">Ghislaine Maxwell</span>
        <span class="suggestion-chip" onclick="doSearch('Bill Gates')">Bill Gates</span>
        <span class="suggestion-chip" onclick="doSearch('Lesley Groff')">Lesley Groff</span>
        <span class="suggestion-chip" onclick="doSearch('Ehud Barak')">Ehud Barak</span>
        <span class="suggestion-chip" onclick="doSearch('Jean-Luc Brunel')">Jean-Luc Brunel</span>
        <span class="suggestion-chip" onclick="doSearch('Les Wexner')">Les Wexner</span>
        <span class="suggestion-chip" onclick="doSearch('Prince Andrew')">Prince Andrew</span>
        <span class="suggestion-chip" onclick="doSearch('Larry Summers')">Larry Summers</span>
      </div>
    </div>
  </main>

  <aside class="sidebar-right" id="rightPanel">
    <div class="panel-card">
      <div class="panel-card-title">Power Index</div>
      <div class="power-row"><span class="power-label">Public Profile</span><div class="power-track"><div class="power-fill" id="pw0" style="width:0%"></div></div><span class="power-val" id="pv0">—</span></div>
      <div class="power-row"><span class="power-label">Institutional</span><div class="power-track"><div class="power-fill" id="pw1" style="width:0%"></div></div><span class="power-val" id="pv1">—</span></div>
    </div>
    <div id="relPanel" style="display:none" class="panel-card">
      <div class="panel-card-title">Relationship to Epstein</div>
      <div id="relContent"></div>
    </div>
    <div id="statusPanel" style="display:none" class="panel-card">
      <div class="panel-card-title">Archive Stats</div>
      <div id="statusContent"></div>
    </div>
  </aside>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>

const SUPABASE_URL = 'https://gljuffkufkggynlaoyim.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdsanVmZmt1ZmtnZ3lubGFveWltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5NDQxNzAsImV4cCI6MjA4NzUyMDE3MH0.TYRbhgiWOFp-Zc5LysfySLR8NeVQdZ9_zh6TpYyNQJE';
const db = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

function toggleTheme() {
  const html = document.documentElement;
  const isDark = html.getAttribute('data-theme') === 'dark';
  html.setAttribute('data-theme', isDark ? 'light' : 'dark');
  document.getElementById('toggleLabel').textContent = isDark ? 'LIGHT' : 'DARK';
}

const searchInput = document.getElementById('searchInput');
let searchTimeout;

searchInput.addEventListener('input', e => {
  clearTimeout(searchTimeout);
  document.querySelectorAll('.filter-item').forEach(el => el.classList.remove('active'));
  const q = e.target.value.trim();
  if (q.length > 1) searchTimeout = setTimeout(() => searchPersons(q), 350);
  else if (q.length === 0) showLanding();
});

searchInput.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    clearTimeout(searchTimeout);
    const q = e.target.value.trim();
    if (q.length > 0) searchPersons(q);
  }
});

document.querySelectorAll('.filter-item').forEach(el => {
  el.addEventListener('click', () => {
    const wasActive = el.classList.contains('active');
    document.querySelectorAll('.filter-item').forEach(x => x.classList.remove('active'));
    if (!wasActive) {
      el.classList.add('active');
      searchInput.value = '';
      browseByFilter(el.dataset.filter, el.dataset.value);
    } else {
      showLanding();
    }
  });
});

function doSearch(name) {
  searchInput.value = name;
  searchPersons(name);
}

async function searchPersons(query) {
  showLoading();
  try {
    const { data, error } = await db
      .from('persons')
      .select('id, full_name, confidence, category, relationship_to_epstein, public_title, total_document_count, power_public_profile, power_institutional, current_status, notes, nationality')
      .ilike('full_name', `%${query}%`)
      .eq('is_victim', false)
      .order('total_document_count', { ascending: false })
      .limit(20);
    if (error) throw error;
    if (!data || data.length === 0) showEmpty(query);
    else if (data.length === 1) renderProfile(data[0]);
    else showResults(data, query);
  } catch(err) { showError(err.message); }
}

async function browseByFilter(field, value) {
  showLoading();
  const col = field === 'category' ? 'category' : 'relationship_to_epstein';
  try {
    const { data, error } = await db
      .from('persons')
      .select('id, full_name, confidence, category, relationship_to_epstein, public_title, total_document_count, power_public_profile, power_institutional, current_status, notes, nationality')
      .eq(col, value)
      .eq('is_victim', false)
      .order('total_document_count', { ascending: false })
      .limit(50);
    if (error) throw error;
    if (!data || data.length === 0) showEmpty(value);
    else showResults(data, value.replace(/_/g,' '));
  } catch(err) { showError(err.message); }
}

function renderProfile(p) {
  const main = document.getElementById('main');
  const notes = p.notes || '';
  const summary = notes.replace(/\[jwiki:[^\]]+\]\s*/, '');
  const emailCount = p.total_document_count || 0;
  const barPct = Math.min(100, Math.round((emailCount / 230115) * 100));
  const rel = p.relationship_to_epstein || 'associate';
  const conf = p.confidence || 'indicated';

  main.innerHTML = `
    <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:1rem;margin-bottom:1rem;">
      <div>
        <div class="subject-name">${p.full_name}</div>
        <div class="subject-meta">
          ${p.public_title ? `<span class="meta-pill">${p.public_title}</span>` : ''}
          ${p.category ? `<span class="meta-pill">${cap(p.category)}</span>` : ''}
          ${p.nationality && p.nationality[0] ? `<span class="meta-pill">${p.nationality[0]}</span>` : ''}
        </div>
      </div>
      <span class="conf-badge ${conf}" style="flex-shrink:0;margin-top:0.25rem;">● ${cap(conf)}</span>
    </div>

    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-value">${emailCount.toLocaleString()}</div>
        <div class="stat-label">Emails in Archive</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" style="font-size:1.1rem;">${cap(rel.replace(/_/g,' '))}</div>
        <div class="stat-label">Relationship</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" style="font-size:1.1rem;">${cap(p.current_status || 'Unknown')}</div>
        <div class="stat-label">Status</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">${p.power_public_profile || '—'}</div>
        <div class="stat-label">Public Profile Score</div>
      </div>
    </div>

    ${summary ? `
    <div style="margin-bottom:1.5rem;">
      <div class="section-title">Intelligence Summary</div>
      <div class="profile-summary">${summary}</div>
    </div>` : ''}

    <div>
      <div class="section-title">Email Volume — Archive Presence</div>
      <div class="email-volume">
        <div class="email-volume-label">
          <span>Emails documented in Epstein archive</span>
          <span>${barPct}% of maximum</span>
        </div>
        <div class="email-volume-bar"><div class="email-volume-fill" style="width:${barPct}%"></div></div>
        <div class="email-volume-count">${emailCount.toLocaleString()}</div>
        <div class="email-volume-sub">source: jmail.world · house oversight committee release</div>
      </div>
    </div>

    <div>
      <div class="section-title">Flight & Event Timeline</div>
      <div style="padding:2rem;text-align:center;background:var(--surface);border:1px dashed var(--border);border-radius:10px;">
        <div style="font-family:'DM Mono',monospace;font-size:0.72rem;color:var(--text-tertiary);letter-spacing:0.1em;margin-bottom:0.5rem;">PIPELINE PHASE 2 — PENDING</div>
        <div style="font-size:0.82rem;color:var(--text-secondary);">Cross-referenced flight manifests, location visits, and documented meetings will appear here.</div>
      </div>
    </div>
  `;

  document.getElementById('pw0').style.width = (p.power_public_profile || 0) + '%';
  document.getElementById('pw1').style.width = (p.power_institutional || 0) + '%';
  document.getElementById('pv0').textContent = p.power_public_profile || 0;
  document.getElementById('pv1').textContent = p.power_institutional || 0;

  const slug = (p.notes || '').match(/\[jwiki:([^\]]+)\]/)?.[1] || '';
  document.getElementById('relPanel').style.display = 'block';
  document.getElementById('relContent').innerHTML = `
    <div style="font-size:0.82rem;color:var(--text-secondary);line-height:1.8;">
      <div><strong style="color:var(--text-primary);">Type:</strong> ${cap(rel.replace(/_/g,' '))}</div>
      <div><strong style="color:var(--text-primary);">Category:</strong> ${cap(p.category || 'Unknown')}</div>
      <div><strong style="color:var(--text-primary);">Status:</strong> ${cap(p.current_status || 'Unknown')}</div>
    </div>
    ${slug ? `<div style="margin-top:0.75rem;padding-top:0.75rem;border-top:1px solid var(--border);">
      <a href="https://jmail.world/wiki/${slug}" target="_blank" style="font-family:'DM Mono',monospace;font-size:0.65rem;color:var(--text-tertiary);text-decoration:none;letter-spacing:0.06em;">VIEW SOURCE ON JMAIL.WORLD ↗</a>
    </div>` : ''}
  `;

  document.getElementById('statusPanel').style.display = 'block';
  document.getElementById('statusContent').innerHTML = `
    <div style="font-family:'DM Mono',monospace;font-size:0.68rem;color:var(--text-secondary);line-height:2;">
      <div>Source: Epstein email archive</div>
      <div>Confidence: ${cap(conf)}</div>
      <div>Indexed: Feb 2026</div>
      <div style="margin-top:0.5rem;padding-top:0.5rem;border-top:1px solid var(--border);color:var(--text-tertiary);">Flight pipeline: phase 2</div>
    </div>
  `;
}

function showResults(persons, query) {
  clearRightPanel();
  document.getElementById('main').innerHTML = `
    <div class="section-title">${persons.length} result${persons.length !== 1 ? 's' : ''} — "${query}"</div>
    <div class="results-grid">
      ${persons.map(p => `
        <div class="result-card" onclick="loadById('${p.id}')">
          <div>
            <div class="result-name">${p.full_name}</div>
            <div class="result-meta">${p.public_title || cap(p.category || 'Unknown')} · ${cap((p.relationship_to_epstein||'associate').replace(/_/g,' '))}</div>
          </div>
          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:0.4rem;">
            <span class="conf-badge ${p.confidence||'indicated'}">${cap(p.confidence||'indicated')}</span>
            <div class="result-docs">${(p.total_document_count||0).toLocaleString()} emails</div>
          </div>
        </div>`).join('')}
    </div>`;
}

async function loadById(id) {
  showLoading();
  const { data } = await db.from('persons').select('*').eq('id', id).single();
  if (data) renderProfile(data);
}

function showLanding() {
  clearRightPanel();
  document.getElementById('main').innerHTML = `
    <div class="landing">
      <div class="landing-title">Search the Epstein Intelligence Database</div>
      <div class="landing-sub">68 individuals indexed from the Epstein email archive. Search by name to view profiles, email volume, and power index.</div>
      <div class="landing-suggestions">
        <span class="suggestion-chip" onclick="doSearch('Ghislaine Maxwell')">Ghislaine Maxwell</span>
        <span class="suggestion-chip" onclick="doSearch('Bill Gates')">Bill Gates</span>
        <span class="suggestion-chip" onclick="doSearch('Lesley Groff')">Lesley Groff</span>
        <span class="suggestion-chip" onclick="doSearch('Ehud Barak')">Ehud Barak</span>
        <span class="suggestion-chip" onclick="doSearch('Jean-Luc Brunel')">Jean-Luc Brunel</span>
        <span class="suggestion-chip" onclick="doSearch('Les Wexner')">Les Wexner</span>
        <span class="suggestion-chip" onclick="doSearch('Prince Andrew')">Prince Andrew</span>
        <span class="suggestion-chip" onclick="doSearch('Larry Summers')">Larry Summers</span>
      </div>
    </div>`;
}

function showLoading() {
  document.getElementById('main').innerHTML = `<div class="state-msg"><div class="state-label">QUERYING DATABASE...</div></div>`;
}

function showEmpty(query) {
  clearRightPanel();
  document.getElementById('main').innerHTML = `
    <div class="state-msg">
      <div class="state-label">NO RESULTS FOR "${String(query).toUpperCase()}"</div>
      <div class="state-sub">Try a different spelling, or browse by category using the filters on the left.</div>
    </div>`;
}

function showError(msg) {
  document.getElementById('main').innerHTML = `<div class="state-msg"><div class="state-label" style="color:var(--unverified);">ERROR: ${msg}</div></div>`;
}

function clearRightPanel() {
  document.getElementById('pw0').style.width = '0%';
  document.getElementById('pw1').style.width = '0%';
  document.getElementById('pv0').textContent = '—';
  document.getElementById('pv1').textContent = '—';
  document.getElementById('relPanel').style.display = 'none';
  document.getElementById('statusPanel').style.display = 'none';
}

function cap(str) {
  if (!str) return '';
  return str.charAt(0).toUpperCase() + str.slice(1);
}

</script>
</body>
</html>
